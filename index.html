<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive revenue model calculator for visualizing 20+ different software pricing strategies">
    <title>Revenue Model Calculator</title>

    <!-- Tailwind CSS via Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ApexCharts for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.0/dist/apexcharts.min.js"></script>

    <style>
        /* Custom styles and overrides will go here */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .container-custom {
            max-width: 1920px;
            margin: 0 auto;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main Container -->
    <div class="container-custom">
        <!-- Header -->
        <header class="bg-white shadow-sm rounded-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Revenue Model Calculator</h1>
            <p class="text-gray-600 mt-2">Visualize and compare different software revenue models</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Sidebar: Model Selection & Input Form -->
            <div class="lg:col-span-1">
                <div class="bg-white shadow-sm rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Select Model</h2>

                    <!-- Model Selector -->
                    <div class="mb-6">
                        <label for="modelSelect" class="block text-sm font-medium text-gray-700 mb-2">
                            Revenue Model
                        </label>
                        <select id="modelSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">-- Select a Model --</option>
                            <!-- Options will be dynamically populated -->
                        </select>
                    </div>

                    <!-- Dynamic Input Form -->
                    <div id="inputForm">
                        <p class="text-gray-500 text-sm">Select a model to see input fields</p>
                    </div>

                    <!-- Calculate Button -->
                    <div class="mt-6">
                        <button id="calculateBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                            Calculate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Content: Charts & Metrics -->
            <div class="lg:col-span-2">
                <!-- Metrics Panel -->
                <div id="metricsPanel" class="bg-white shadow-sm rounded-lg p-6 mb-6 hidden">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">Key Metrics</h2>
                    <div id="metricsContent" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Metrics will be dynamically populated -->
                    </div>
                </div>

                <!-- Primary Chart -->
                <div id="primaryChartContainer" class="bg-white shadow-sm rounded-lg p-6 mb-6 hidden">
                    <div id="primaryChart"></div>
                </div>

                <!-- Secondary Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="secondaryChart1Container" class="bg-white shadow-sm rounded-lg p-6 hidden">
                        <div id="secondaryChart1"></div>
                    </div>
                    <div id="secondaryChart2Container" class="bg-white shadow-sm rounded-lg p-6 hidden">
                        <div id="secondaryChart2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>Revenue Model Calculator | Open Source | Built with ApexCharts & Tailwind CSS</p>
        </footer>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const CONFIG = {
            defaultForecastMonths: 24,
            maxForecastMonths: 36,
            debounceDelay: 300,
            chartColors: {
                primary: '#3B82F6',
                positive: '#10B981',
                moderate: '#F59E0B',
                negative: '#EF4444',
                secondary: '#6B7280'
            }
        };

        // Store chart instances for cleanup
        let chartInstances = {
            primary: null,
            secondary1: null,
            secondary2: null
        };

        // ========== MODEL DEFINITIONS ==========
        const models = {
            'one-time': {
                name: 'One-Time Purchase (Perpetual License)',
                inputs: [
                    { name: 'unitPrice', label: 'Unit Price per License ($)', type: 'currency', default: 499, min: 0, step: 1 },
                    { name: 'unitsSold', label: 'Units Sold per Month', type: 'number', default: 25, min: 0, step: 1 },
                    { name: 'maintenanceFee', label: 'Annual Maintenance Fee (%)', type: 'percent', default: 20, min: 0, max: 100, step: 0.1 },
                    { name: 'maintenanceAttach', label: 'Maintenance Attach Rate (%)', type: 'percent', default: 60, min: 0, max: 100, step: 0.1 },
                    { name: 'customerLifetime', label: 'Customer Lifetime (years)', type: 'number', default: 5, min: 1, step: 1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let totalCustomers = 0;

                    for (let month = 0; month < months; month++) {
                        const newCustomers = inputs.unitsSold;
                        totalCustomers += newCustomers;

                        const licenseRevenue = newCustomers * inputs.unitPrice;
                        const customersWithMaintenance = totalCustomers * (inputs.maintenanceAttach / 100);
                        const maintenanceRevenue = customersWithMaintenance * inputs.unitPrice * (inputs.maintenanceFee / 100) / 12;
                        const totalRevenue = licenseRevenue + maintenanceRevenue;

                        results.push({
                            month: month + 1,
                            licenseRevenue: licenseRevenue,
                            maintenanceRevenue: maintenanceRevenue,
                            totalRevenue: totalRevenue,
                            totalCustomers: totalCustomers,
                            unitsSold: newCustomers
                        });
                    }

                    return results;
                }
            },
            'subscription': {
                name: 'Subscription (SaaS)',
                inputs: [
                    { name: 'monthlyPrice', label: 'Monthly Subscription Price ($)', type: 'currency', default: 99, min: 0, step: 1 },
                    { name: 'newCustomers', label: 'New Customers per Month', type: 'number', default: 50, min: 0, step: 1 },
                    { name: 'churnRate', label: 'Monthly Churn Rate (%)', type: 'percent', default: 5, min: 0, max: 100, step: 0.1 },
                    { name: 'startingCustomers', label: 'Starting Customer Base', type: 'number', default: 0, min: 0, step: 1 },
                    { name: 'expansionRate', label: 'Monthly Expansion Revenue (%)', type: 'percent', default: 2, min: 0, max: 100, step: 0.1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let customers = inputs.startingCustomers;
                    let avgRevenuePerCustomer = inputs.monthlyPrice;

                    for (let month = 0; month < months; month++) {
                        const newMRR = inputs.newCustomers * inputs.monthlyPrice;
                        const churnedCustomers = customers * (inputs.churnRate / 100);
                        const churnedMRR = churnedCustomers * avgRevenuePerCustomer;
                        const expansionMRR = customers * avgRevenuePerCustomer * (inputs.expansionRate / 100);

                        customers = customers + inputs.newCustomers - churnedCustomers;
                        const mrr = customers * avgRevenuePerCustomer + expansionMRR;
                        avgRevenuePerCustomer = customers > 0 ? mrr / customers : inputs.monthlyPrice;

                        results.push({
                            month: month + 1,
                            customers: Math.round(customers),
                            mrr: mrr,
                            arr: mrr * 12,
                            newMRR: newMRR,
                            churnedMRR: churnedMRR,
                            expansionMRR: expansionMRR,
                            revenuePerCustomer: avgRevenuePerCustomer
                        });
                    }

                    return results;
                }
            },
            'freemium': {
                name: 'Freemium',
                inputs: [
                    { name: 'freeUsers', label: 'Free Users Acquired per Month', type: 'number', default: 500, min: 0, step: 1 },
                    { name: 'conversionRate', label: 'Free-to-Paid Conversion Rate (%)', type: 'percent', default: 3, min: 0, max: 100, step: 0.1 },
                    { name: 'timeToConversion', label: 'Time to Conversion (months)', type: 'number', default: 2, min: 1, step: 1 },
                    { name: 'paidPrice', label: 'Paid Subscription Price ($)', type: 'currency', default: 49, min: 0, step: 1 },
                    { name: 'freeChurn', label: 'Free User Churn Rate (%)', type: 'percent', default: 15, min: 0, max: 100, step: 0.1 },
                    { name: 'paidChurn', label: 'Paid User Churn Rate (%)', type: 'percent', default: 5, min: 0, max: 100, step: 0.1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let freeUsers = 0;
                    let paidUsers = 0;
                    const cohorts = [];

                    for (let month = 0; month < months; month++) {
                        // Add new free users
                        freeUsers += inputs.freeUsers;
                        cohorts.push({ month: month, users: inputs.freeUsers, converted: 0 });

                        // Convert users from eligible cohorts
                        let newConversions = 0;
                        cohorts.forEach(cohort => {
                            if (month - cohort.month >= inputs.timeToConversion) {
                                const eligible = cohort.users - cohort.converted;
                                const converting = eligible * (inputs.conversionRate / 100);
                                cohort.converted += converting;
                                newConversions += converting;
                            }
                        });

                        // Apply churn
                        freeUsers = freeUsers * (1 - inputs.freeChurn / 100) - newConversions;
                        paidUsers = paidUsers + newConversions;
                        paidUsers = paidUsers * (1 - inputs.paidChurn / 100);

                        const revenue = paidUsers * inputs.paidPrice;
                        const totalUsers = freeUsers + paidUsers;

                        results.push({
                            month: month + 1,
                            freeUsers: Math.round(freeUsers),
                            paidUsers: Math.round(paidUsers),
                            totalUsers: Math.round(totalUsers),
                            revenue: revenue,
                            conversionRate: totalUsers > 0 ? (paidUsers / totalUsers * 100) : 0,
                            newConversions: Math.round(newConversions)
                        });
                    }

                    return results;
                }
            },
            'usage-based': {
                name: 'Usage-Based (Consumption)',
                inputs: [
                    { name: 'pricePerUnit', label: 'Price per Unit ($)', type: 'currency', default: 0.05, min: 0, step: 0.01 },
                    { name: 'avgUsage', label: 'Avg Usage per Customer per Month', type: 'number', default: 1000, min: 0, step: 1 },
                    { name: 'usageGrowth', label: 'Usage Growth per Customer (% monthly)', type: 'percent', default: 5, min: 0, max: 100, step: 0.1 },
                    { name: 'newCustomers', label: 'New Customers per Month', type: 'number', default: 20, min: 0, step: 1 },
                    { name: 'churnRate', label: 'Customer Churn Rate (%)', type: 'percent', default: 3, min: 0, max: 100, step: 0.1 },
                    { name: 'usageVariance', label: 'Usage Std Deviation (%)', type: 'percent', default: 20, min: 0, max: 100, step: 1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let customers = 0;
                    let avgUsagePerCustomer = inputs.avgUsage;

                    for (let month = 0; month < months; month++) {
                        customers = customers + inputs.newCustomers;
                        customers = customers * (1 - inputs.churnRate / 100);

                        avgUsagePerCustomer = avgUsagePerCustomer * (1 + inputs.usageGrowth / 100);
                        const totalUsage = customers * avgUsagePerCustomer;
                        const revenue = totalUsage * inputs.pricePerUnit;
                        const revenuePerCustomer = customers > 0 ? revenue / customers : 0;

                        const variance = revenue * (inputs.usageVariance / 100);

                        results.push({
                            month: month + 1,
                            customers: Math.round(customers),
                            totalUsage: totalUsage,
                            avgUsage: avgUsagePerCustomer,
                            revenue: revenue,
                            revenuePerCustomer: revenuePerCustomer,
                            revenueHigh: revenue + variance,
                            revenueLow: Math.max(0, revenue - variance)
                        });
                    }

                    return results;
                }
            },
            'tiered': {
                name: 'Tiered Pricing',
                inputs: [
                    { name: 'starterPrice', label: 'Starter Tier Price ($)', type: 'currency', default: 29, min: 0, step: 1 },
                    { name: 'proPrice', label: 'Professional Tier Price ($)', type: 'currency', default: 99, min: 0, step: 1 },
                    { name: 'enterprisePrice', label: 'Enterprise Tier Price ($)', type: 'currency', default: 299, min: 0, step: 1 },
                    { name: 'starterPct', label: 'Starter Tier % of New Customers', type: 'percent', default: 60, min: 0, max: 100, step: 1 },
                    { name: 'proPct', label: 'Pro Tier % of New Customers', type: 'percent', default: 30, min: 0, max: 100, step: 1 },
                    { name: 'enterprisePct', label: 'Enterprise Tier % of New Customers', type: 'percent', default: 10, min: 0, max: 100, step: 1 },
                    { name: 'newCustomers', label: 'New Customers per Month', type: 'number', default: 100, min: 0, step: 1 },
                    { name: 'upgradeRate', label: 'Monthly Upgrade Rate (%)', type: 'percent', default: 2, min: 0, max: 100, step: 0.1 },
                    { name: 'downgradeRate', label: 'Monthly Downgrade Rate (%)', type: 'percent', default: 1, min: 0, max: 100, step: 0.1 },
                    { name: 'churnRate', label: 'Monthly Churn Rate (%)', type: 'percent', default: 5, min: 0, max: 100, step: 0.1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let starterCustomers = 0;
                    let proCustomers = 0;
                    let enterpriseCustomers = 0;

                    for (let month = 0; month < months; month++) {
                        // Add new customers
                        const newStarter = inputs.newCustomers * (inputs.starterPct / 100);
                        const newPro = inputs.newCustomers * (inputs.proPct / 100);
                        const newEnterprise = inputs.newCustomers * (inputs.enterprisePct / 100);

                        starterCustomers += newStarter;
                        proCustomers += newPro;
                        enterpriseCustomers += newEnterprise;

                        // Handle upgrades and downgrades
                        const starterUpgrade = starterCustomers * (inputs.upgradeRate / 100);
                        const proUpgrade = proCustomers * (inputs.upgradeRate / 100);
                        const proDowngrade = proCustomers * (inputs.downgradeRate / 100);
                        const enterpriseDowngrade = enterpriseCustomers * (inputs.downgradeRate / 100);

                        starterCustomers -= starterUpgrade;
                        starterCustomers += proDowngrade;

                        proCustomers += starterUpgrade;
                        proCustomers -= proUpgrade;
                        proCustomers -= proDowngrade;
                        proCustomers += enterpriseDowngrade;

                        enterpriseCustomers += proUpgrade;
                        enterpriseCustomers -= enterpriseDowngrade;

                        // Apply churn
                        starterCustomers *= (1 - inputs.churnRate / 100);
                        proCustomers *= (1 - inputs.churnRate / 100);
                        enterpriseCustomers *= (1 - inputs.churnRate / 100);

                        const starterRevenue = starterCustomers * inputs.starterPrice;
                        const proRevenue = proCustomers * inputs.proPrice;
                        const enterpriseRevenue = enterpriseCustomers * inputs.enterprisePrice;
                        const totalRevenue = starterRevenue + proRevenue + enterpriseRevenue;

                        results.push({
                            month: month + 1,
                            starterCustomers: Math.round(starterCustomers),
                            proCustomers: Math.round(proCustomers),
                            enterpriseCustomers: Math.round(enterpriseCustomers),
                            starterRevenue: starterRevenue,
                            proRevenue: proRevenue,
                            enterpriseRevenue: enterpriseRevenue,
                            totalRevenue: totalRevenue,
                            totalCustomers: Math.round(starterCustomers + proCustomers + enterpriseCustomers)
                        });
                    }

                    return results;
                }
            },
            'per-seat': {
                name: 'Per-Seat/Per-User',
                inputs: [
                    { name: 'pricePerSeat', label: 'Price per Seat per Month ($)', type: 'currency', default: 25, min: 0, step: 1 },
                    { name: 'avgSeats', label: 'Avg Seats per Customer at Signup', type: 'number', default: 5, min: 1, step: 1 },
                    { name: 'seatExpansion', label: 'Seat Expansion Rate (% monthly)', type: 'percent', default: 3, min: 0, max: 100, step: 0.1 },
                    { name: 'customerChurn', label: 'Customer Churn Rate (%)', type: 'percent', default: 4, min: 0, max: 100, step: 0.1 },
                    { name: 'newCustomers', label: 'New Customers per Month', type: 'number', default: 30, min: 0, step: 1 }
                ],
                calculate: function(inputs, months) {
                    const results = [];
                    let customers = 0;
                    let totalSeats = 0;

                    for (let month = 0; month < months; month++) {
                        // Add new customers with their initial seats
                        customers += inputs.newCustomers;
                        totalSeats += inputs.newCustomers * inputs.avgSeats;

                        // Expand seats for existing customers
                        totalSeats = totalSeats * (1 + inputs.seatExpansion / 100);

                        // Apply customer churn (seats churn with customers)
                        const avgSeatsPerCustomer = customers > 0 ? totalSeats / customers : inputs.avgSeats;
                        const churnedCustomers = customers * (inputs.customerChurn / 100);
                        const churnedSeats = churnedCustomers * avgSeatsPerCustomer;

                        customers -= churnedCustomers;
                        totalSeats -= churnedSeats;

                        const revenue = totalSeats * inputs.pricePerSeat;
                        const seatsPerCustomer = customers > 0 ? totalSeats / customers : inputs.avgSeats;
                        const revenuePerCustomer = customers > 0 ? revenue / customers : 0;

                        results.push({
                            month: month + 1,
                            customers: Math.round(customers),
                            totalSeats: Math.round(totalSeats),
                            avgSeatsPerCustomer: seatsPerCustomer,
                            revenue: revenue,
                            revenuePerCustomer: revenuePerCustomer
                        });
                    }

                    return results;
                }
            }
        };

        // ========== UTILITY FUNCTIONS ==========

        /**
         * Format currency value with proper decimals
         */
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        /**
         * Format percentage value
         */
        function formatPercentage(value) {
            return `${value.toFixed(1)}%`;
        }

        /**
         * Format large numbers with thousand separators
         */
        function formatNumber(value) {
            return new Intl.NumberFormat('en-US').format(Math.round(value));
        }

        /**
         * Validate input based on type
         */
        function validateInput(type, value) {
            const numValue = parseFloat(value);

            if (isNaN(numValue)) return false;
            if (numValue < 0) return false;

            if (type === 'percent' && numValue > 100) return false;

            return true;
        }

        /**
         * Debounce function for input handling
         */
        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // ========== FORM GENERATION ==========

        /**
         * Generate dynamic form based on model inputs
         */
        function generateForm(modelKey) {
            const model = models[modelKey];
            const formContainer = document.getElementById('inputForm');

            let formHTML = `<h3 class="text-lg font-semibold text-gray-900 mb-4">Input Parameters</h3>`;

            model.inputs.forEach(input => {
                formHTML += `
                    <div class="mb-4">
                        <label for="${input.name}" class="block text-sm font-medium text-gray-700 mb-1">
                            ${input.label}
                        </label>
                        <input
                            type="number"
                            id="${input.name}"
                            name="${input.name}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            value="${input.default}"
                            min="${input.min !== undefined ? input.min : 0}"
                            ${input.max !== undefined ? 'max="' + input.max + '"' : ''}
                            step="${input.step}"
                            data-type="${input.type}"
                        />
                    </div>
                `;
            });

            formContainer.innerHTML = formHTML;

            // Add input event listeners
            model.inputs.forEach(input => {
                const inputElement = document.getElementById(input.name);
                inputElement.addEventListener('input', onInputChange);
            });
        }

        // ========== CALCULATION ENGINE ==========

        /**
         * Calculate results for the selected model
         */
        function calculateModel(modelKey) {
            const model = models[modelKey];
            const inputs = {};

            // Gather input values
            model.inputs.forEach(input => {
                const element = document.getElementById(input.name);
                inputs[input.name] = parseFloat(element.value);
            });

            // Run calculation
            const results = model.calculate(inputs, CONFIG.defaultForecastMonths);

            return results;
        }

        // ========== CHART RENDERING ==========

        /**
         * Destroy existing chart if it exists
         */
        function destroyChart(chartKey) {
            if (chartInstances[chartKey]) {
                chartInstances[chartKey].destroy();
                chartInstances[chartKey] = null;
            }
        }

        /**
         * Render charts for the selected model
         */
        function renderCharts(modelKey, data) {
            // Destroy existing charts
            destroyChart('primary');
            destroyChart('secondary1');
            destroyChart('secondary2');

            // Model-specific chart rendering
            if (modelKey === 'one-time') {
                renderOneTimePurchaseCharts(data);
            } else if (modelKey === 'subscription') {
                renderSubscriptionCharts(data);
            } else if (modelKey === 'freemium') {
                renderFreemiumCharts(data);
            } else if (modelKey === 'usage-based') {
                renderUsageBasedCharts(data);
            } else if (modelKey === 'tiered') {
                renderTieredCharts(data);
            } else if (modelKey === 'per-seat') {
                renderPerSeatCharts(data);
            }
        }

        function renderOneTimePurchaseCharts(data) {
            // Primary Chart: Revenue over time (stacked area)
            const primaryOptions = {
                series: [
                    {
                        name: 'License Revenue',
                        data: data.map(d => d.licenseRevenue.toFixed(2))
                    },
                    {
                        name: 'Maintenance Revenue',
                        data: data.map(d => d.maintenanceRevenue.toFixed(2))
                    }
                ],
                chart: {
                    type: 'area',
                    height: 400,
                    stacked: true,
                    toolbar: { show: true }
                },
                colors: [CONFIG.chartColors.primary, CONFIG.chartColors.positive],
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.7, opacityTo: 0.3 } },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45, rotateAlways: false }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: {
                    y: { formatter: val => formatCurrency(val) }
                },
                legend: { position: 'top' },
                title: { text: 'Revenue Breakdown: License vs Maintenance', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Total Revenue Line
            const secondary1Options = {
                series: [{
                    name: 'Total Revenue',
                    data: data.map(d => d.totalRevenue.toFixed(2))
                }],
                chart: { type: 'line', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                title: { text: 'Total Monthly Revenue', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: Customer Growth
            const secondary2Options = {
                series: [{
                    name: 'Total Customers',
                    data: data.map(d => d.totalCustomers)
                }],
                chart: { type: 'bar', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary],
                plotOptions: {
                    bar: { borderRadius: 4, dataLabels: { position: 'top' } }
                },
                dataLabels: { enabled: false },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Customers' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) } },
                title: { text: 'Customer Base Growth', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        function renderSubscriptionCharts(data) {
            // Primary Chart: MRR Growth
            const primaryOptions = {
                series: [
                    {
                        name: 'MRR',
                        data: data.map(d => d.mrr.toFixed(2))
                    },
                    {
                        name: 'ARR',
                        data: data.map(d => d.arr.toFixed(2))
                    }
                ],
                chart: { type: 'line', height: 400, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary, CONFIG.chartColors.positive],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                legend: { position: 'top' },
                title: { text: 'MRR and ARR Growth', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Customer Count
            const secondary1Options = {
                series: [{
                    name: 'Customers',
                    data: data.map(d => d.customers)
                }],
                chart: { type: 'area', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                fill: { type: 'gradient', gradient: { opacityFrom: 0.6, opacityTo: 0.2 } },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Customers' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) } },
                title: { text: 'Customer Count', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: MRR Components
            const secondary2Options = {
                series: [
                    {
                        name: 'New MRR',
                        data: data.map(d => d.newMRR.toFixed(2))
                    },
                    {
                        name: 'Expansion MRR',
                        data: data.map(d => d.expansionMRR.toFixed(2))
                    },
                    {
                        name: 'Churned MRR',
                        data: data.map(d => -d.churnedMRR.toFixed(2))
                    }
                ],
                chart: { type: 'bar', height: 300, stacked: true, toolbar: { show: true } },
                colors: [CONFIG.chartColors.positive, CONFIG.chartColors.moderate, CONFIG.chartColors.negative],
                plotOptions: { bar: { borderRadius: 4 } },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'MRR Change ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(Math.abs(val)) } },
                legend: { position: 'top' },
                title: { text: 'MRR Components', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        function renderFreemiumCharts(data) {
            // Primary Chart: Free vs Paid Users
            const primaryOptions = {
                series: [
                    {
                        name: 'Free Users',
                        data: data.map(d => d.freeUsers)
                    },
                    {
                        name: 'Paid Users',
                        data: data.map(d => d.paidUsers)
                    }
                ],
                chart: { type: 'area', height: 400, stacked: true, toolbar: { show: true } },
                colors: [CONFIG.chartColors.secondary, CONFIG.chartColors.positive],
                fill: { type: 'gradient', gradient: { opacityFrom: 0.6, opacityTo: 0.3 } },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Users' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) } },
                legend: { position: 'top' },
                title: { text: 'Free vs Paid Users', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Revenue from Paid Users
            const secondary1Options = {
                series: [{
                    name: 'Revenue',
                    data: data.map(d => d.revenue.toFixed(2))
                }],
                chart: { type: 'line', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                title: { text: 'Revenue from Paid Users', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: Conversion Rate
            const secondary2Options = {
                series: [{
                    name: 'Conversion Rate',
                    data: data.map(d => d.conversionRate.toFixed(2))
                }],
                chart: { type: 'line', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Conversion Rate (%)' },
                    labels: { formatter: val => val.toFixed(1) + '%' }
                },
                tooltip: { y: { formatter: val => val.toFixed(1) + '%' } },
                title: { text: 'Free-to-Paid Conversion Rate', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        function renderUsageBasedCharts(data) {
            // Primary Chart: Revenue with variance band
            const primaryOptions = {
                series: [
                    {
                        name: 'Revenue',
                        data: data.map(d => d.revenue.toFixed(2))
                    },
                    {
                        name: 'High Range',
                        data: data.map(d => d.revenueHigh.toFixed(2))
                    },
                    {
                        name: 'Low Range',
                        data: data.map(d => d.revenueLow.toFixed(2))
                    }
                ],
                chart: { type: 'line', height: 400, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary, CONFIG.chartColors.positive, CONFIG.chartColors.negative],
                stroke: { curve: 'smooth', width: [3, 1, 1], dashArray: [0, 5, 5] },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                legend: { position: 'top' },
                title: { text: 'Revenue with Usage Variance', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Average Usage per Customer
            const secondary1Options = {
                series: [{
                    name: 'Avg Usage',
                    data: data.map(d => d.avgUsage.toFixed(2))
                }],
                chart: { type: 'area', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                fill: { type: 'gradient', gradient: { opacityFrom: 0.6, opacityTo: 0.2 } },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Units' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) + ' units' } },
                title: { text: 'Avg Usage per Customer', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: Revenue per Customer
            const secondary2Options = {
                series: [{
                    name: 'Revenue per Customer',
                    data: data.map(d => d.revenuePerCustomer.toFixed(2))
                }],
                chart: { type: 'bar', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary],
                plotOptions: { bar: { borderRadius: 4 } },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                title: { text: 'Revenue per Customer', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        function renderTieredCharts(data) {
            // Primary Chart: Revenue by Tier
            const primaryOptions = {
                series: [
                    {
                        name: 'Starter Revenue',
                        data: data.map(d => d.starterRevenue.toFixed(2))
                    },
                    {
                        name: 'Professional Revenue',
                        data: data.map(d => d.proRevenue.toFixed(2))
                    },
                    {
                        name: 'Enterprise Revenue',
                        data: data.map(d => d.enterpriseRevenue.toFixed(2))
                    }
                ],
                chart: { type: 'area', height: 400, stacked: true, toolbar: { show: true } },
                colors: [CONFIG.chartColors.secondary, CONFIG.chartColors.primary, CONFIG.chartColors.positive],
                fill: { type: 'gradient', gradient: { opacityFrom: 0.6, opacityTo: 0.3 } },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                legend: { position: 'top' },
                title: { text: 'Revenue by Tier', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Customer Distribution by Tier
            const secondary1Options = {
                series: [
                    {
                        name: 'Starter',
                        data: data.map(d => d.starterCustomers)
                    },
                    {
                        name: 'Professional',
                        data: data.map(d => d.proCustomers)
                    },
                    {
                        name: 'Enterprise',
                        data: data.map(d => d.enterpriseCustomers)
                    }
                ],
                chart: { type: 'bar', height: 300, stacked: true, toolbar: { show: true } },
                colors: [CONFIG.chartColors.secondary, CONFIG.chartColors.primary, CONFIG.chartColors.positive],
                plotOptions: { bar: { borderRadius: 4 } },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Customers' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) } },
                legend: { position: 'top' },
                title: { text: 'Customer Distribution by Tier', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: Total Revenue
            const secondary2Options = {
                series: [{
                    name: 'Total Revenue',
                    data: data.map(d => d.totalRevenue.toFixed(2))
                }],
                chart: { type: 'line', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                title: { text: 'Total Revenue', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        function renderPerSeatCharts(data) {
            // Primary Chart: Total Seats
            const primaryOptions = {
                series: [{
                    name: 'Total Seats',
                    data: data.map(d => d.totalSeats)
                }],
                chart: { type: 'area', height: 400, toolbar: { show: true } },
                colors: [CONFIG.chartColors.primary],
                fill: { type: 'gradient', gradient: { opacityFrom: 0.6, opacityTo: 0.3 } },
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `Month ${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Seats' },
                    labels: { formatter: val => formatNumber(val) }
                },
                tooltip: { y: { formatter: val => formatNumber(val) + ' seats' } },
                title: { text: 'Total Seats Over Time', align: 'center', style: { fontSize: '16px', fontWeight: 600 } }
            };

            document.getElementById('primaryChartContainer').classList.remove('hidden');
            chartInstances.primary = new ApexCharts(document.getElementById('primaryChart'), primaryOptions);
            chartInstances.primary.render();

            // Secondary Chart 1: Average Seats per Customer
            const secondary1Options = {
                series: [{
                    name: 'Avg Seats',
                    data: data.map(d => d.avgSeatsPerCustomer.toFixed(2))
                }],
                chart: { type: 'line', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.moderate],
                stroke: { curve: 'smooth', width: 3 },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Seats' },
                    labels: { formatter: val => val.toFixed(1) }
                },
                tooltip: { y: { formatter: val => val.toFixed(1) + ' seats' } },
                title: { text: 'Avg Seats per Customer', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart1Container').classList.remove('hidden');
            chartInstances.secondary1 = new ApexCharts(document.getElementById('secondaryChart1'), secondary1Options);
            chartInstances.secondary1.render();

            // Secondary Chart 2: Revenue
            const secondary2Options = {
                series: [{
                    name: 'Revenue',
                    data: data.map(d => d.revenue.toFixed(2))
                }],
                chart: { type: 'bar', height: 300, toolbar: { show: true } },
                colors: [CONFIG.chartColors.positive],
                plotOptions: { bar: { borderRadius: 4 } },
                xaxis: {
                    categories: data.map(d => `M${d.month}`),
                    labels: { rotate: -45 }
                },
                yaxis: {
                    title: { text: 'Revenue ($)' },
                    labels: { formatter: val => formatCurrency(val) }
                },
                tooltip: { y: { formatter: val => formatCurrency(val) } },
                title: { text: 'Monthly Revenue', align: 'center', style: { fontSize: '14px', fontWeight: 600 } }
            };

            document.getElementById('secondaryChart2Container').classList.remove('hidden');
            chartInstances.secondary2 = new ApexCharts(document.getElementById('secondaryChart2'), secondary2Options);
            chartInstances.secondary2.render();
        }

        /**
         * Update metrics panel with calculated values
         */
        function updateMetrics(modelKey, data) {
            const metricsPanel = document.getElementById('metricsPanel');
            const metricsContent = document.getElementById('metricsContent');

            const lastMonth = data[data.length - 1];
            const firstMonth = data[0];

            // Calculate total revenue
            const totalRevenue = data.reduce((sum, d) => {
                if (modelKey === 'one-time') return sum + d.totalRevenue;
                if (modelKey === 'subscription') return sum + d.mrr;
                if (modelKey === 'freemium') return sum + d.revenue;
                if (modelKey === 'usage-based') return sum + d.revenue;
                if (modelKey === 'tiered') return sum + d.totalRevenue;
                if (modelKey === 'per-seat') return sum + d.revenue;
                return sum;
            }, 0);

            // Calculate average growth rate
            const revenueValues = data.map(d => {
                if (modelKey === 'one-time') return d.totalRevenue;
                if (modelKey === 'subscription') return d.mrr;
                if (modelKey === 'freemium') return d.revenue;
                if (modelKey === 'usage-based') return d.revenue;
                if (modelKey === 'tiered') return d.totalRevenue;
                if (modelKey === 'per-seat') return d.revenue;
                return 0;
            });

            let totalGrowth = 0;
            let growthCount = 0;
            for (let i = 1; i < revenueValues.length; i++) {
                if (revenueValues[i-1] > 0) {
                    const growth = ((revenueValues[i] - revenueValues[i-1]) / revenueValues[i-1]) * 100;
                    totalGrowth += growth;
                    growthCount++;
                }
            }
            const avgGrowth = growthCount > 0 ? totalGrowth / growthCount : 0;

            // Model-specific metrics
            let metricsHTML = `
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Total Revenue</div>
                    <div class="text-2xl font-bold text-gray-900">${formatCurrency(totalRevenue)}</div>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Avg Monthly Growth</div>
                    <div class="text-2xl font-bold text-gray-900">${formatPercentage(avgGrowth)}</div>
                </div>
                <div class="bg-orange-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Final Month Revenue</div>
                    <div class="text-2xl font-bold text-gray-900">${formatCurrency(revenueValues[revenueValues.length - 1])}</div>
                </div>
            `;

            // Add model-specific metric
            if (modelKey === 'subscription') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Final ARR</div>
                        <div class="text-2xl font-bold text-gray-900">${formatCurrency(lastMonth.arr)}</div>
                    </div>
                `;
            } else if (modelKey === 'freemium') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Conversion Rate</div>
                        <div class="text-2xl font-bold text-gray-900">${formatPercentage(lastMonth.conversionRate)}</div>
                    </div>
                `;
            } else if (modelKey === 'usage-based') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Avg Usage per Customer</div>
                        <div class="text-2xl font-bold text-gray-900">${formatNumber(lastMonth.avgUsage)}</div>
                    </div>
                `;
            } else if (modelKey === 'tiered') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Total Customers</div>
                        <div class="text-2xl font-bold text-gray-900">${formatNumber(lastMonth.totalCustomers)}</div>
                    </div>
                `;
            } else if (modelKey === 'per-seat') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Total Seats</div>
                        <div class="text-2xl font-bold text-gray-900">${formatNumber(lastMonth.totalSeats)}</div>
                    </div>
                `;
            } else if (modelKey === 'one-time') {
                metricsHTML += `
                    <div class="bg-purple-50 rounded-lg p-4">
                        <div class="text-sm text-gray-600">Total Customers</div>
                        <div class="text-2xl font-bold text-gray-900">${formatNumber(lastMonth.totalCustomers)}</div>
                    </div>
                `;
            }

            metricsContent.innerHTML = metricsHTML;
            metricsPanel.classList.remove('hidden');
        }

        // ========== EVENT HANDLERS ==========

        /**
         * Handle model selection change
         */
        function onModelChange(event) {
            const selectedModel = event.target.value;

            if (!selectedModel) {
                document.getElementById('inputForm').innerHTML = '<p class="text-gray-500 text-sm">Select a model to see input fields</p>';
                document.getElementById('calculateBtn').disabled = true;

                // Hide all charts and metrics
                document.getElementById('metricsPanel').classList.add('hidden');
                document.getElementById('primaryChartContainer').classList.add('hidden');
                document.getElementById('secondaryChart1Container').classList.add('hidden');
                document.getElementById('secondaryChart2Container').classList.add('hidden');

                return;
            }

            // Generate form for selected model
            generateForm(selectedModel);

            // Enable calculate button
            document.getElementById('calculateBtn').disabled = false;

            // Auto-calculate with default values
            performCalculation();
        }

        /**
         * Handle input field changes (debounced)
         */
        const onInputChange = debounce(function(event) {
            performCalculation();
        }, CONFIG.debounceDelay);

        /**
         * Handle calculate button click
         */
        function onCalculate() {
            performCalculation();
        }

        /**
         * Perform the calculation and update UI
         */
        function performCalculation() {
            const modelSelect = document.getElementById('modelSelect');
            const selectedModel = modelSelect.value;

            if (!selectedModel) return;

            // Calculate results
            const results = calculateModel(selectedModel);

            // Update charts
            renderCharts(selectedModel, results);

            // Update metrics
            updateMetrics(selectedModel, results);
        }

        // ========== INITIALIZATION ==========

        /**
         * Initialize the application
         */
        function init() {
            // Populate model selector
            const modelSelect = document.getElementById('modelSelect');

            for (const [key, model] of Object.entries(models)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = model.name;
                modelSelect.appendChild(option);
            }

            // Add event listeners
            modelSelect.addEventListener('change', onModelChange);

            const calculateBtn = document.getElementById('calculateBtn');
            calculateBtn.addEventListener('click', onCalculate);
        }

        // Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
